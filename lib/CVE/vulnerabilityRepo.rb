class CVE::VulnerabilityRepo
  attr_accessor :name, :text, :date, :year, :references
  CVEs = []
  
  def initialize(attributes = nil)
    @name = attributes.to_str.split("\n")[1] if attributes != nil
    @text = attributes.to_str 
    # Regex to select element that begins with http or https for reference
    @references = attributes.to_str.split("\n").select {|reference| reference[/https?:/]} if attributes != nil
    # Regex to select element that begins with http or https for date
    @date = attributes.to_str.split("\n").select {|date| date[/\d{4}.\d{2}.\d{2}/]} if attributes != nil
    CVEs << self
  end

  def self.new_from_page(attributes)
    self.new(attributes)
  end

  def clear
    self.all.clear
  end

  def self.all
    CVEs
  end

  # method that allows user to get date, and if no date get the text for CVE
  def getDate
    self.date == nil || self.date == [] ? "No date. #{self.text}" : self.date
  end

  # method that allows user to search for specific vulnerability based on name
  def self.findByName(name)
    result = self.all.select {|vulnerability| name == vulnerability.name}
    result.each {|x| puts x.text}
  end 

  #create method that allows user to see vulnerabilities based on month which is a two char string
  def self.findByMonth(month)
    vulnerabilities = self.all.reject {|vulnerability| vulnerability.date == []}
    result = vulnerabilities.select {|vulnerability| month == vulnerability.date.first.split("-")[1]}
    result.each {|x| puts x.text}
    puts
  end

  #create method that allows user to find all microsoft vulnerabilities or anything that contains user input(like a search)
  def self.search(text)
    result = self.all.select {|vulnerability| vulnerability.text.include?(text)}
    result.each {|x| puts x.text}
  end
end