class VulnerabilityRepo
  attr_accessor :name, :text, :date, :references
  CVEs = []
  
  def initialize(attributes)
    @name = attributes.split("\n")[1]
    @text = attributes
    # Regex to select element that begins with http or https for reference
    @references = attributes.split("\n").select {|reference| reference[/https?:/]}
    # Regex to select element that begins with http or https for date
    @date = attributes.split("\n").select {|date| date[/\d{4}.\d{2}.\d{2}/]}
    binding.pry
    CVEs << self
  end

  def self.all
    CVEs
  end

  # method that allows user to get date, and if no date get the text for CVE
  def getDate
    self.date == nil || self.date == [] ? "No date. #{self.text}" : self.date
  end

  # method that allows user to search for specific vulnerability based on name
  def self.findByName(name)
    VulnerabilityRepo.all.select {|vulnerability| name == vulnerability.name}
  end 

  #create method that allows user to see vulnerabilities based on month which is a two char string
  def self.findByMonth(month)
    vulnerabilities = VulnerabilityRepo.all.reject {|vulnerability| vulnerability.date == []}
    binding.pry
    vulnerabilities.select {|vulnerability| month == vulnerability.date.first.split("-")[1]}
  end

  #create method that allows user to find all microsoft vulnerabilities or anything that contains user input(like a search)
  def self.search(text)
    VulnerabilityRepo.all.select {|vulnerability| vulnerability.text.include?(text)}
  end
end